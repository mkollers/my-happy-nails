<?xml version="1.0" encoding="utf-8"?>
<configuration>
    <configSections>
        <section name="resizer" type="ImageResizer.ResizerSection" requirePermission="false"/>
    </configSections>
    <resizer>
     <!-- Unless you (a) use Integrated mode, or (b) map all requests to ASP.NET, 
          you'll need to add .ashx to your image URLs: image.jpg.ashx?width=200&height=20 -->
     <pipeline fakeExtensions=".ashx" defaultCommands="autorotate.default=true"/>

     <plugins>
       <add name="DiskCache" />
       <!-- <add name="PrettyGifs" /> -->
       <!-- <add name="SimpleFilters" /> -->
       <!-- <add name="S3Reader" /> -->
     </plugins>  
   </resizer>
    <system.webServer>
        <httpCompression directory="%SystemDrive%\inetpub\temp\IIS Temporary Compressed Files">
            <scheme name="gzip" dll="%Windir%\system32\inetsrv\gzip.dll"/>
            <dynamicTypes>
                <add mimeType="text/*" enabled="true"/>
                <add mimeType="message/*" enabled="true"/>
                <add mimeType="application/x-javascript" enabled="true"/>
                <add mimeType="application/json" enabled="true"/>
                <add mimeType="*/*" enabled="false"/>
            </dynamicTypes>
            <staticTypes>
                <add mimeType="text/*" enabled="true"/>
                <add mimeType="message/*" enabled="true"/>
                <add mimeType="application/x-javascript" enabled="true"/>
                <add mimeType="application/atom+xml" enabled="true"/>
                <add mimeType="application/xaml+xml" enabled="true"/>
                <add mimeType="*/*" enabled="false"/>
            </staticTypes>
        </httpCompression>
        <urlCompression doStaticCompression="true" doDynamicCompression="true"/>
        <security>
            <requestFiltering removeServerHeader="true"/>
        </security>
        <staticContent>
            <!-- only for live -->
            <mimeMap fileExtension=".json" mimeType="application/json"/>
            <remove fileExtension=".woff" /> <!-- In case IIS already has this mime type -->
            <mimeMap fileExtension=".woff" mimeType="application/x-font-woff" />
            <remove fileExtension=".woff2" /> <!-- In case IIS already has this mime type -->
            <mimeMap fileExtension=".woff2" mimeType="application/x-font-woff2" />
            <clientCache cacheControlMode="UseMaxAge" cacheControlMaxAge="2.00:00:00" />
        </staticContent>
        <rewrite>
            <rules>
                <!--# Only proxy the request to Prerender if it's a request for HTML-->
                <rule name="Seo rewrite rule" stopProcessing="true">
                    <serverVariables>
                        <set name="X-Prerender-Token" value="GPD3fV9iCt1DSzebO1pk" />
                    </serverVariables>
                    <conditions>
                        <add input="{QUERY_STRING}" pattern="(.*)_escaped_fragment_=(.*)" />
                    </conditions>
                    <action type="Rewrite" url="http://service.prerender.io/http://{HTTP_HOST}{REQUEST_URI}" appendQueryString="false" />
                </rule>
                <rule name="AngularJS Routes" stopProcessing="true">
                    <match url=".*"/>
                    <conditions logicalGrouping="MatchAll">
                        <add input="{REQUEST_FILENAME}" matchType="IsFile" negate="true"/>
                        <add input="{REQUEST_FILENAME}" matchType="IsDirectory" negate="true"/>
                    </conditions>
                    <action type="Rewrite" url="/"/>
                </rule>
                <rule name="Redirect to non-www" stopProcessing="true">
                    <match url="(.*)$" negate="false"></match>
                    <conditions logicalGrouping="MatchAll">
                        <add input="{HTTP_HOST}" pattern="^www\.(.+)$" />
                    </conditions>
                    <action type="Redirect" url="http://{C:1}/{R:1}" redirectType="Permanent"></action>
                </rule>                
            </rules>
        </rewrite>
        <validation validateIntegratedModeConfiguration="false"/>
        <modules>
            <add name="ImageResizingModule" type="ImageResizer.InterceptModule"/>
        </modules>
        <httpProtocol>
            <customHeaders>
                <remove name="Server"/>
                <remove name="X-Aspnet-Version"/>
                <remove name="X-Powered-By"/>
                <remove name="X-Powered"/>                
                <add name="X-XSS-Protection" value="1; mode=block"/>
                <!--<add name="Content-Security-Policy" value="default-src 'self';"/>-->
            </customHeaders>
        </httpProtocol>
    </system.webServer>
    <system.web>
        <compilation debug="true" targetFramework="4.5.2"/>
        <httpRuntime targetFramework="4.5.2"/>
        <customErrors mode="Off"/>
        <httpModules>
            <add name="ImageResizingModule" type="ImageResizer.InterceptModule"/>
        </httpModules>
    </system.web>
    <system.codedom>
        <compilers>
            <compiler
                language="c#;cs;csharp"
                extension=".cs"
                type="Microsoft.CodeDom.Providers.DotNetCompilerPlatform.CSharpCodeProvider, Microsoft.CodeDom.Providers.DotNetCompilerPlatform, Version=1.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"
                warningLevel="4"
                compilerOptions="/langversion:6 /nowarn:1659;1699;1701"/>
            <compiler
                language="vb;vbs;visualbasic;vbscript"
                extension=".vb"
                type="Microsoft.CodeDom.Providers.DotNetCompilerPlatform.VBCodeProvider, Microsoft.CodeDom.Providers.DotNetCompilerPlatform, Version=1.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"
                warningLevel="4"
                compilerOptions="/langversion:14 /nowarn:41008 /define:_MYTYPE=\&quot;Web\&quot; /optionInfer+"/>
        </compilers>
    </system.codedom>
</configuration>
